---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.1
  name: instrumentationconfigs.odigos.io
spec:
  group: odigos.io
  names:
    kind: InstrumentationConfig
    listKind: InstrumentationConfigList
    plural: instrumentationconfigs
    singular: instrumentationconfig
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: InstrumentationConfig is the Schema for the instrumentationconfig
          API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: |-
              Config for the OpenTelemeetry SDKs that should be applied to a workload.
              The workload is identified by the owner reference
            properties:
              runtimeDetailsInvalidated:
                description: true when the runtime details are invalidated and should
                  be recalculated
                type: boolean
              sdkConfigs:
                description: |-
                  Configuration for the OpenTelemetry SDKs that this workload should use.
                  The SDKs are identified by the programming language they are written in.
                items:
                  properties:
                    headSamplerConfig:
                      description: |-
                        HeadSamplingConfig is a set sampling rules.
                        This config currently only applies to root spans.
                        In the Future we might add another level of configuration base on the parent span (ParentBased Sampling)
                      properties:
                        attributesAndSamplerRules:
                          items:
                            description: |-
                              AttributesAndSamplerRule is a set of AttributeCondition that are ANDed together.
                              If all attribute conditions evaluate to true, the AND sampler evaluates to true,
                              and the fraction is used to determine the sampling decision.
                              If any of the attribute compare samplers evaluate to false,
                              the fraction is not used and the rule is skipped.
                              An "empty" AttributesAndSamplerRule with no attribute conditions is considered to always evaluate to true.
                              and the fraction is used to determine the sampling decision.
                              This entity is refered to a rule in Odigos terminology for head-sampling.
                            properties:
                              attributeConditions:
                                items:
                                  description: '''Operand'' represents the attributes
                                    and values that an operator acts upon in an expression'
                                  properties:
                                    key:
                                      description: attribute key (e.g. "url.path")
                                      type: string
                                    operator:
                                      description: The operator to use to compare
                                        the attribute value.
                                      enum:
                                      - equals
                                      - notEquals
                                      - endWith
                                      - startWith
                                      type: string
                                    val:
                                      description: currently only string values are
                                        supported.
                                      type: string
                                  required:
                                  - key
                                  - val
                                  type: object
                                type: array
                              fraction:
                                default: 1
                                description: |-
                                  The fraction of spans to sample, in the range [0, 1].
                                  If the fraction is 0, no spans are sampled.
                                  If the fraction is 1, all spans are sampled.
                                type: number
                            required:
                            - attributeConditions
                            - fraction
                            type: object
                          type: array
                        fallbackFraction:
                          default: 1
                          description: |-
                            Used as a fallback if all rules evaluate to false,
                            it may be empty - in this case the default value will be 1 - all spans are sampled.
                            it should be a float value in the range [0, 1] - the fraction of spans to sample.
                            a value of 0 means no spans are sampled if none of the rules evaluate to true.
                          type: number
                      required:
                      - attributesAndSamplerRules
                      - fallbackFraction
                      type: object
                    instrumentationLibraryConfigs:
                      description: configurations for the instrumentation libraries
                        the the SDK should use
                      items:
                        properties:
                          capabilities:
                            description: A list of enabled capabilities for the instrumentation
                              library and their configuration.
                            items:
                              description: |-
                                Each instrumentation library can implement a set of capabilities that can be configured by the user.
                                The capabilities should be published by the instrumentation library and documented elsewhere.
                                If the capability is not used, it should be omitted from the configuration.
                              properties:
                                capabilityName:
                                  description: |-
                                    Each instrumentation library advertise a set of capabilities that can be configured be the users.
                                    The capability name is used to identify the capability that is being configured.
                                  type: string
                                parameters:
                                  description: |-
                                    The parameters that can be configured for the capability, which are specific to the capability and the instrumentation library.
                                    Used to configure the behavior of the capability.
                                  items:
                                    description: |-
                                      The InstrumentationLibraryCapabilityParameter represents a single configuration property that can be set for an instrumentation library option.
                                      For example, the capability might be payload collection, and the parameter can be the maximum size of the payload to record,
                                      if to skip recording incomplete payloads, conditions for recording payload (for example only for specific mime types - "only application/json"),
                                      additional attributes to record original length, etc.
                                    properties:
                                      booleanValue:
                                        description: |-
                                          If this parameter value is boolean, the boolean value should be set here.
                                          Default value for any boolean parameter is false, which can be omitted in this case.
                                        type: boolean
                                      intValue:
                                        description: |-
                                          When the value is an integer, the integer value should be set here.
                                          For example: number of bytes, number of items, etc.
                                          If absent, the instrumentation library can use a pre-defined default value
                                          which can be any number that makes sense for the parameter (not necessarily 0).
                                          To use a value 0 and not the default, set the value to 0 instead of omitting it.
                                        type: integer
                                      numberValue:
                                        description: |-
                                          If this parameter value is for a number, the number value should be set here.
                                          If absent, the instrumentation library can use a pre-defined default value
                                          which can be any number that makes sense for the parameter (not necessarily 0).
                                          To use a value 0 and not the default, set the value to 0 instead of omitting it.
                                        type: number
                                      parameterName:
                                        description: The name of the property that
                                          should be configured for the instrumentation
                                          library option
                                        type: string
                                      stringListValue:
                                        description: |-
                                          If the parameter value is a list of strings, the list should be set here.
                                          If absent, the instrumentation library can use a pre-defined default value (not necessarily an empty list).
                                          To use an empty list, set the value to an empty list instead of omitting it.
                                        items:
                                          type: string
                                        type: array
                                      stringValue:
                                        description: |-
                                          StringValue is used for string parameters.
                                          If absent, the instrumentation library can use a pre-defined default value (not necessarily empty string).
                                          To use an empty string, set the value to an empty string instead of omitting it.
                                        type: string
                                    required:
                                    - parameterName
                                    type: object
                                  type: array
                              required:
                              - capabilityName
                              type: object
                            type: array
                          libraryId:
                            properties:
                              libraryName:
                                description: |-
                                  The name of the instrumentation library
                                  - Node.js: The name of the npm package: `@opentelemetry/instrumentation-<name>`
                                type: string
                              spanKind:
                                description: |-
                                  SpanKind is only supported by Golang and will be ignored for any other SDK language.
                                  In Go, SpanKind is used because the same instrumentation library can be utilized for different span kinds (e.g., client/server).
                                enum:
                                - client
                                - server
                                - producer
                                - consumer
                                - internal
                                type: string
                            required:
                            - libraryName
                            type: object
                          traceConfig:
                            properties:
                              enabled:
                                description: |-
                                  Whether the instrumentation library is enabled to record traces.
                                  When false, it is expected that the instrumentation library does not produce any spans regardless of any other configuration.
                                  When true, the instrumentation library should produce spans according to the other configuration options.
                                  If not specified, the default value for this signal should be used (whether to enable libraries by default or not).
                                type: boolean
                            type: object
                        required:
                        - libraryId
                        type: object
                      type: array
                    language:
                      description: The language of the SDK being configured
                      enum:
                      - java
                      - python
                      - go
                      - dotnet
                      - javascript
                      - mysql
                      - nginx
                      - unknown
                      - ignored
                      type: string
                  required:
                  - instrumentationLibraryConfigs
                  - language
                  type: object
                type: array
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
